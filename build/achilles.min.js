function callMe(){something++,angular.element("html").scope().$broadcast("somethingChanged")}!function(){"use strict";angular.module("achilles",["ngResource","ngSanitize","ui.bootstrap","rt.select2","textAngular"])}(),function(){"use strict";function a(a){a.interceptors.push("SpinnerHttpInterceptor")}function b(a,b){var c={response:function(a){return a.config.spinner&&b(function(){$("#loading-overlay").css("display","none")},150),a},responseError:function(c){return c.config.spinner&&b(function(){$("#loading-overlay").css("display","none")},150),a.reject(c)},request:function(a){return"GET"==a.method&&a.spinner&&$("#loading-overlay").css("display","block"),a}};return c}angular.module("achilles").config(a).factory("SpinnerHttpInterceptor",b),a.$inject=["$httpProvider"],b.$inject=["$q","$timeout"]}(),function(){"use strict";function a(a){a.decorator("taOptions",["taRegisterTool","$delegate",function(a,b){return a("colorRed",{iconclass:"fa fa-square red-text",action:function(){this.$editor().wrapSelection("forecolor","red")}}),a("colorBlue",{iconclass:"fa fa-square blue-text",action:function(){this.$editor().wrapSelection("forecolor","blue")}}),a("colorOrange",{iconclass:"fa fa-square orange-text",action:function(){this.$editor().wrapSelection("forecolor","orange")}}),a("colorGreen",{iconclass:"fa fa-square green-text",action:function(){this.$editor().wrapSelection("forecolor","green")}}),a("colorBlack",{iconclass:"fa fa-square",action:function(){this.$editor().wrapSelection("forecolor","black")}}),a("colorGrey",{iconclass:"fa fa-square grey-text",action:function(){this.$editor().wrapSelection("forecolor","lightgrey")}}),b.toolbar=[["bold","italics","underline","colorRed","colorOrange","colorGreen","colorBlue","colorBlack","colorGrey","ul","ol","redo","undo","clear"]],b}])}angular.module("achilles").config(a),a.$inject=["$provide"]}(),function(){"use strict";function a(a,b,c,d,e){function f(){a.get(b.treatmentList(achillesConfig.patient),{spinner:!0}).then(function(a){h.treatments=a.data})}function g(){c.get(achillesConfig.process).then(function(a){h.user=a})}var h=this;h.baseUrl=b.baseUrl(),h.entries=[],h.loadEntries=f,h.process=achillesConfig.process,h.patient=achillesConfig.patient,h.reverse=!1,h.search={},h.marginOptions=[{"class":"large-margins",label:"Grosse Abstände"},{"class":"small-margins",label:"Kleine Abstände"}],h.fontSizes=[{"class":"large-fonts",label:"Gross"},{"class":"medium-fonts",label:"Mittel"},{"class":"small-fonts",label:"Klein"}],h.checkEditPermission=d.checkEditPermission,h.loadEntries(),g(),console.log("maincontroller line 32 ")}angular.module("achilles").controller("MainController",a),a.$inject=["$http","urls","User","TreatmentPermission","EntryType"]}(),function(){"use strict";function a(a,b){a.ok=function(){b.close()},a.cancel=function(){b.dismiss("canceled")}}function b(a,b){a.presets=[{id:1,name:"SOAP"},{id:2,name:"Gynäkologische Untersuchung"},{id:3,name:"Vermicelles"},{id:4,name:"Schoggischuum"}],a.close=function(a){b.close(a)}}angular.module("achilles").controller("DeleteModalController",a).controller("PresetModalController",b),a.$inject=["$scope","$modalInstance"],b.$inject=["$scope","$modalInstance"]}(),function(){"use strict";function a(){var a={controller:b,controllerAs:"dc",restrict:"E",scope:{search:"="},templateUrl:"../js/templates/advanced-search-widget.tpl.html"};return a}function b(a){function b(a){a.text="",a.attachments={},delete a.dateFrom,delete a.dateTo}function c(a){a.preventDefault(),a.stopPropagation(),e.fromOpened=!0}function d(a){a.preventDefault(),a.stopPropagation(),e.toOpened=!0}var e=this;e.clearSearch=b,e.fromOpened=!1,e.isVisible=a.isVisible,e.openFromDatepicker=c,e.openToDatepicker=d,e.showWidget=a.show,e.toOpened=!1}angular.module("achilles").directive("advancedSearchWidget",a),b.$inject=["AdvancedSearchWidget"]}(),function(){"use strict";function a(){function a(a,b,c){var d={};c.draggableHandle&&(d.handle=c.draggableHandle),b.draggable(d)}var b={restrict:"A",link:a};return b}angular.module("achilles").directive("draggable",a)}(),function(){"use strict";function a(){function a(a,b,c){function d(a){function c(a){for(var b=0;b<a.length;b++)if(a.eq(b).hasClass("focused"))return b;return-1}function d(a){var c=b.find(".list-group"),d=c.scrollTop()+a.position().top-(c.height()-50);c.animate({scrollTop:d},0)}if((38==a.which||40==a.which||13==a.which)&&g){a.preventDefault();var h=b.find(e),i=b.find(e+f),j=c(h),k=h.length;38==a.which?(h.removeClass("focused"),i=j>0?h.eq(j-1).addClass("focused"):h.eq(k-1).addClass("focused"),d(i)):40==a.which?(h.removeClass("focused"),i=j>=0?h.eq((j+1)%k).addClass("focused"):h.eq(0).addClass("focused"),d(i)):13==a.which&&(i.click(),i.removeClass("focused"),b.blur())}}var e=c.focusable,f=".focused",g=!1;c.$observe("active",function(a){g="true"===a?!0:!1}),b.on("keydown",d)}var b={restrict:"A",link:a};return b}angular.module("achilles").directive("keyboardFocus",a)}(),function(){"use strict";function a(a){function b(b,c,d){console.log(document.activeElement);var e=c.find("textarea");a(function(){console.log(document.activeElement),e.focus(),console.log("trying"),console.log(document.activeElement)},5e3),c.find("a").on("click",function(){console.log("focus"),e.select2("open")})}var c={link:b};return c}angular.module("achilles").directive("modalSelect2",a),a.$inject=["$timeout"]}(),function(){"use strict";function a(){var a={restrict:"E",controller:b,controllerAs:"dc",templateUrl:"../js/templates/preset-widget.tpl.html"};return a}function b(a){var b=this;b.isVisible=a.isVisible}angular.module("achilles").directive("presetWidget",a),b.$inject=["PresetWidget"]}(),function(){"use strict";function a(){var a={restrict:"E",controller:b,controllerAs:"dc",scope:{},templateUrl:"../js/templates/textblock-widget.tpl.html"};return a}function b(a,b,c,d,e){function f(b){b&&(i.textGroups=a("filter")(h,{treatmentEntryType:b.id}),i.selectedGroup={})}function g(a){var c="";if(!angular.isDefined(a))return void i.showWidget(!1);c=angular.isArray(a)?a.map(function(a){return a.text}).join(" "):a;var e=b.getCurrentlyFocusedColumn(),f=b.getCurrentlyFocusedRow(),g=b.getCurrentlyFocusedEntry();e&&g&&(e.content+=c,d.save(f,g)),i.showWidget(!1)}var h,i=this;i.insertSelection=g,i.isVisible=c.isVisible,i.showWidget=c.show,c.addObserverCallback(f),e.all().then(function(a){i.textGroups=h=a})}angular.module("achilles").directive("textBlockWidget",a),b.$inject=["$filter","CurrentFocus","TextBlockWidget","TreatmentRow","TextBlock"]}(),function(){"use strict";function a(){function a(a,b,c){c.$observe("show",function(){console.log("changed",c.show),a.showWidget=a.$eval(c.show)})}var c={restrict:"E",controller:b,controllerAs:"dc",link:a,scope:{showWidget:"="},templateUrl:"../js/templates/title-settings-widget.tpl.html"};return c}function b(a,b,c,d){function e(a,b){a.forEach(function(a){c.changeVisibility(a,h.user,b)})}function f(b,d,e){if(e.altKey){var f=a("filter")(h.entryTypes,function(a){return a!==b&&!a.hidden}).length>0;h.entryTypes.forEach(function(a){b!==a&&c.changeVisibility(a,h.user,!f)}),c.changeVisibility(b,h.user,!0)}else c.changeVisibility(b,h.user,d)}function g(){c.get(achillesConfig.process).then(function(a){h.user=a,b.all().then(function(b){c.setVisibleEntryTypes(b,a),h.entryTypes=b})})}var h=this;h.changeTypeStatus=f,h.changeAll=e,h.isVisible=d.getTitleSettingsWidgetVisibility,h.showWidget=d.showTitleSettingsWidget,g()}angular.module("achilles").directive("titleSettingsWidget",a),a.$inject=["$timeout"],b.$inject=["$filter","EntryType","User","WidgetVisibility"]}(),function(){"use strict";function a(a){function b(b,c,d,e){c.on("click",function(){e.isOpen()&&a(function(){c.find("li a").eq(0).focus()},150)}),c.on("keydown","li a",function(a){if(40==a.which){a.preventDefault();var b=$(this).parent().nextAll(":visible:not(.divider)").first().find("a"),c=$(this).parent().siblings().first().find("a");b.length?b.focus():c.focus()}if(38==a.which){a.preventDefault();var d=$(this).parent().prevAll(":visible:not(.divider)").first().find("a"),e=$(this).parent().siblings().last().find("a");d.length?d.focus():e.focus()}})}var c={require:"dropdown",link:b};return c}angular.module("achilles").directive("toggleFocus",a),a.$inject=["$timeout"]}(),function(){"use strict";function a(a,c,d,e,f,g,h,i){function j(a){return"true"==a?m.editable:m.readonly}function k(a,b,c,k){function m(c){b.html(j(c)).show(),e(b.contents())(a)}function n(b){angular.element(this).hasClass("ng-dirty")&&!a.row.locked&&i.save(a.row,a.entry),d(function(){a.entry.focused=!1},150),d.cancel(l)}function o(c){if(a.row.locked&&w(c))c.preventDefault();else if(c.ctrlKey&&c.shiftKey&&8==c.which){var e=b.parents(".row").prev().find(".ta-bind:not(:disabled)"),f=b.parents(".row").next().find(".ta-bind:not(:disabled)"),j=b.parents("treatment-entry").prev().find(".ta-bind:not(:disabled)"),k=b.parents("treatment-entry").next().find(".ta-bind:not(:disabled)");d(function(){e.length?e.eq(0).focus():j.length?j.eq(0).focus():f.length?f.eq(0).focus():k.eq(0).focus()},150),x.removeRow(a.row,a.entry,a.treatment.entries)}else 27==c.keyCode?x.showCatalog=!1:c.ctrlKey&&13==c.which?(i.save(a.row,a.entry),h.addEntry(a.treatment.id,a.entry.type,a.treatment.entries)):!a.row.hasOwnLock&&w(c)&&g.lock(a.row)}function p(){d(function(){x.showCatalog=!1},150)}function q(b){w(b)&&13!=b.which&&x.lookupCatalogEntries(a.column.content.replace(/<[^>]*>/gm,""),a.row,a.column),f.setCurrentCursor()}function r(){x.showCatalog=!0,x.setCatalog(a.row),f.setCurrentFocus(a.column,a.row,a.entry),f.clearNewFocus(),a.warning&&!a.warning.displayed&&(toastr.warning(a.warning.message),a.warning.displayed=!0),l=d(function(){g.check(a.row)},450),d(function(){a.entry.focused=!0},250)}function s(b){a.readonly()&&a.warning&&!a.warning.displayed&&(toastr.error(a.warning.message),a.warning.displayed=!0),d(function(){f.setCurrentCursor()},50)}function t(a,b){if(!a.length)return null;for(var c=a[0],d=c.innerHTML.replace(/<[^>]*>/,"").split(""),e=b;e<d.length;e++)if("*"===d[e])return e;return-1}function u(a){if(!a.length)return null;var b=a[0];return v(b)}function v(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(3==c.nodeType){if(c.nodeValue.indexOf("*")>=0)return c}else{var d=v(c);if(d)return d}}return null}function w(a){return!(9==a.which||a.which>=37&&a.which<=40||a.ctrlKey&&65==a.which||a.ctrlKey&&67==a.which)}var x=(k[0],k[1]);a.columnClass="col-xs-"+c.width,b.on("blur",".ta-bind",n),b.on("keydown",".ta-bind",o),b.on("focus",".ta-bind",r),b.on("click",".ta-bind",s),b.on("keyup",".ta-bind",q),b.on("focusout",p),c.$observe("editable",m),m(c.editable),a.$watch(f.getNewlyFocusedRow,function(c){if(c&&a.row.id==c.id){var d=b.find(".ta-bind:not(.ta-readonly)");d.eq(0).focus();var e=u(d),g=f.getCurrentCursor(),h=t(d,g);if(h>=0){var i=document.createRange();i.setStart(e,h),i.setEnd(e,h+1);var j=window.getSelection();j.removeAllRanges(),j.addRange(i),f.setCurrentCursor()}}})}var l,m={editable:'<div ng-class="columnClass" class="treatment-column" catalog-prompt><div class="form-group"><div ng-model="column.content" placeholder="{{column.placeholder}}" ta-disabled="readonly()" text-angular ta-target-toolbars="toolbar-{{treatment.id}}-{{type.id}}"></div></div></div>',readonly:'<div ng-class="columnClass"><p ng-bind-html="readonlyContent" class="read-only-content"></p></div>'},n={restrict:"E",scope:{width:"@",column:"=",readonly:"&",row:"=",uniqueId:"@",treatment:"=",warning:"=",type:"=",entry:"="},require:["^treatment","^treatmentEntry"],controller:b,link:k};return n}function b(a,b){a.readonlyContent=b.trustAsHtml(a.column.content)}angular.module("achilles").directive("treatmentColumn",a),a.$inject=["$http","urls","$timeout","$compile","CurrentFocus","Locking","Treatment","TreatmentRow"],b.$inject=["$scope","$sce"]}(),function(){"use strict";function a(){function a(a,b,c,d){}var c={scope:{entry:"=",editable:"@",treatment:"=",permissionToEdit:"&",warning:"="},restrict:"E",templateUrl:"../js/templates/treatment-entry.tpl.html",require:"^treatment",controller:b,controllerAs:"dc",link:a};return c}function b(a,b,c,d,e,f,g){function h(a,d){g.cancelSave(),c.choose(a,d).then(function(a){b(function(){g.replace(d,a)})})}function i(a){return p.user.hiddenEntryTypes&&p.user.hiddenEntryTypes.indexOf(a.id)>-1}function j(){d.get(achillesConfig.process).then(function(a){p.user=a})}function k(a,d,e){b.cancel(o),o=b(function(){c.lookup(a,d,e).then(function(a){l(d,a)})},350)}function l(a,b){var c={};angular.isDefined(a)&&(c.id=a.id),angular.isDefined(b)&&(c.entries=b),p.catalog=c}function m(b){a.entry.focused=b}function n(){a.entryform.$setPristine()}var o,p=this;p.chooseCatalogEntry=h,p.isHidden=i,p.lookupCatalogEntries=k,p.makePristine=n,p.removeRow=f.removeRow,p.setCatalog=l,p.setEntryFocus=m,p.showTextBlockWidget=e.show,p.user={},p.showCatalog=!0,l(),j()}angular.module("achilles").directive("treatmentEntry",a),b.$inject=["$scope","$timeout","CatalogEntry","User","TextBlockWidget","TreatmentEntry","TreatmentRow"]}(),function(){"use strict";function a(a){function b(b,c){function d(){a(function(){var a=c.find(".ta-bind:not(.ta-readonly)").eq(0);a.focus()},150)}b.$watch("row.changed",function(a){a&&d()}),b.row["new"]===!0&&d()}var c={link:b};return c}angular.module("achilles").directive("treatmentRow",a),a.$inject=["$timeout"]}(),function(){"use strict";function a(){var a={restrict:"E",controller:b,controllerAs:"toolbar",templateUrl:"../js/templates/treatment-toolbar.tpl.html"};return a}function b(a,b,c,d,e,f,g,h){function i(b){var d=b.length?a("orderBy")(b,["-date","id"])[0]:{id:0};c.addTreatment(d,!0,!0,b)}var j=this;j.addTreatment=i,j.asteriskSearch=g.search,j.openBiometricReport=d.open,j.openLaboratoryReport=f.open,j.openTreatmentReport=c.openReport,j.executeGDT=e.execute,j.showAdvancedSearch=b.show,j.showTitleSettingsWidget=h.showTitleSettingsWidget,e.load(j)}angular.module("achilles").directive("treatmentToolbar",a),b.$inject=["$filter","AdvancedSearchWidget","Treatment","Biometric","GDT","LaboratoryReport","AsteriskSearch","WidgetVisibility"]}(),function(){"use strict";function a(a){function c(b,c,d,e){var f;b.treatment.editable=b.editable,c.on("keydown",function(a){120==a.which&&e.permissionToEdit&&c.find(".type-and-preset-search").focus()}),c.on("focusin",function(){a(function(){b.treatment.focused=!0,b.editable=!0,b.treatment.editable=!0}),a.cancel(f)}),c.on("focusout",function(){f=a(function(){b.treatment.focused=!1},300)}),c.on("select2-open",function(){b.select2Open=!0}),c.on("select2-blur",function(){b.select2Open=!1})}var d={scope:{treatment:"=",treatments:"=treatmentlist",editable:"@",user:"="},restrict:"E",controller:b,controllerAs:"dc",templateUrl:"../js/templates/treatment.tpl.html",link:c};return d}function b(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(b,c,d){g.addEntry(b,c,d).then(function(){a.active=!1})}function o(a){PresetWidget.getName().then(function(b){m.create(a,b)})}function p(a){a&&!t.documents&&i.list(u).then(function(a){t.documents=a},function(a){console.error(a.statusText),t.documents=[]})}function q(a){a&&!t.laboratoryReports&&j.list(u).then(function(a){t.laboratoryReports=a},function(){})}function r(a){a&&!t.biometrics&&k.list(u).then(function(a){t.biometrics=a},function(){})}function s(a){a&&!t.disabilityCertificates&&l.list(u).then(function(a){t.disabilityCertificates=a},function(){})}var t=this,u=a.treatment.id;t.newEntry={type:null},d.all().then(function(a){t.types=a}),h.all().then(function(a){t.subjects=a}),m.all().then(function(a){t.presets=a}),t.addEntry=n,t.addPreset=g.addPreset,t.createPreset=o,t.loadDocuments=p,t.loadLaboratoryReports=q,t.loadBiometrics=r,t.loadDisability=s,t.baseUrl=c.baseUrl(),t.addTreatment=g.addTreatment,t.copyTreatment=g.copyTreatment,t.deleteTreatment=g.deleteTreatment,t.changeStatus=g.changeStatus,t.changeSubject=g.changeSubject,t.removeCase=g.removeCase,t.warning={},t.permissionToEdit=!1,t.removeEntry=g.removeEntry,f.get().then(function(b){t.warning=e.shouldBeWarned(b,a.treatment),t.permissionToEdit=e.checkEditPermission(b,a.treatment)})}angular.module("achilles").directive("treatment",a),a.$inject=["$timeout"],b.$inject=["$scope","$modal","urls","EntryType","TreatmentPermission","User","Treatment","Subject","Document","LaboratoryReport","Biometric","DisabilityCertificate","Preset"]}(),function(){"use strict";function a(a){function b(b,c,d){function e(){a(function(){b.active=!0})}function f(){a(function(){b.active=!1},150)}function g(d){function e(){c.find("a.list-group-item:visible").first().addClass("focused")}function g(){c.find("a.list-group-item:visible").last().addClass("focused")}function h(a){var b=c.find(".list-group"),d=b.scrollTop()+a.position().top-(b.height()-50);b.animate({scrollTop:d},0)}var i=c.find("a.list-group-item.focused");if(8==d.which||d.which>40)a(function(){i.removeClass("focused"),angular.isDefined(b.search)&&b.search.term>""&&e()},50);else if(40==d.which)if(d.preventDefault(),i.length){var j=i.nextAll("a.list-group-item:visible").first();i.removeClass("focused"),j.addClass("focused"),h(j)}else e();else if(38==d.which)if(d.preventDefault(),i.length){var k=i.prevAll("a.list-group-item:visible").first();i.removeClass("focused"),k.addClass("focused"),h(k)}else g();else 13==d.which?i.click():27==d.keyCode&&f()}c.on("focusin",e),c.on("blur",f),c.find(".type-and-preset-search").on("blur",f),c.find(".type-and-preset-search").on("keyup",g)}var c={restrict:"A",link:b};return c}angular.module("achilles").directive("typeAndPreset",a),a.$inject=["$timeout"]}(),function(){"use strict";function a(){function a(a,b){var c=[];return angular.isDefined(b)?(a.forEach(function(a){var d=!0;b.medication!==!0||a.hasMedication||(d=!1),b.laboratory!==!0||a.hasLaboratory||(d=!1),b.service!==!0||a.hasService||(d=!1),b.disability!==!0||a.hasDisability||(d=!1),b.biometric!==!0||a.hasBiometric||(d=!1),b.document!==!0||a.hasDocument||(d=!1),d&&c.push(a)}),c):a}return a}angular.module("achilles").filter("attachments",a)}(),function(){"use strict";function a(){function a(a,b,c){var d=[];if(!angular.isDefined(a))return d;if(!angular.isDate(b)&&!/^\d{2}\.\d{2}\.(\d{2}|\d{4})$/.test(b))return a;if(!angular.isDate(b)){var e=b.split("."),f=e[0],g=e[1],h=e[2];b=new Date(h,g-1,f)}return a.forEach(function(a){("after"==c&&a.date>=b.getTime()||"before"==c&&a.date<=b.getTime())&&d.push(a)}),d}return a}angular.module("achilles").filter("compareDate",a)}();var something=0;toastr.options={positionClass:"toast-top-full-width"},function(){"use strict";function a(){function a(){return c}function b(a){c=a}var c=!1,d={isVisible:a,show:b};return d}angular.module("achilles").factory("AdvancedSearchWidget",a)}(),function(){"use strict";function a(a,b){function c(c){var d,e,f,g,h=[];if(d=b.getCurrentlyFocusedRow(),c.forEach(function(b){if("true"===b.editable||b.editable===!0){var c=a("orderBy")(b.entries,"type.name");c.forEach(function(a){a.rows.forEach(function(a){h.push(a)})})}}),d){for(var i=b.getCurrentlyFocusedColumn(),j=i.content.replace(/<[^>]>/,"").split(""),k=0,l=0;l<j.length;l++)"*"==j[l]&&(k=l);k>b.getCurrentCursor()?f=h.slice(h.indexOf(d)):(f=h.slice(h.indexOf(d)+1),b.setCurrentCursor(0))}else f=h;g=a("filter")(f,{$:"*"}),0===g.length&&(g=a("filter")(h,{$:"*"})),e=g.shift(),e&&(console.log(e),b.setNewFocus(e))}var d={search:c};return d}angular.module("achilles").factory("AsteriskSearch",a),a.$inject=["$filter","CurrentFocus"]}(),function(){"use strict";function a(a,b){function c(c){return a.get(b.biometricList(c),{spinner:!0}).then(function(a){return a.data})}function d(c){a.get(b.biometricReport(c))}var e={list:c,open:d};return e}angular.module("achilles").service("Biometric",a),a.$inject=["$http","urls"]}(),function(){"use strict";function a(a,b,c){function d(b,d){return a.post(c.catalogRow(d),b).then(function(a){return a.data})}function e(d,e,f){return a.get(c.catalogEntries(d,e,f)).then(function(a){var c=a.data;return angular.forEach(c,function(a){angular.forEach(a.cols,function(a){a.trustedContent=b.trustAsHtml(a.content)})}),c})}var f={choose:d,lookup:e};return f}angular.module("achilles").factory("CatalogEntry",a),a.$inject=["$http","$sce","urls"]}(),function(){"use strict";function a(){function a(){return m}function b(){return k}function c(){return l}function d(){return j}function e(){return n}function f(a){if(angular.isDefined(a))m=a;else{var b=window.getSelection();m=b.focusOffset}}function g(a,b,c){k=a,j=b,l=c}function h(){n=null}function i(a){n=a}var j,k,l,m,n,o={clearNewFocus:h,getCurrentCursor:a,getCurrentlyFocusedColumn:b,getCurrentlyFocusedEntry:c,setCurrentCursor:f,setCurrentFocus:g,getCurrentlyFocusedRow:d,setNewFocus:i,getNewlyFocusedRow:e};return o}angular.module("achilles").factory("CurrentFocus",a)}(),function(){"use strict";function a(a,b){function c(c){return a.get(b.disabilityList(c),{spinner:!0}).then(function(a){return a.data})}var d={list:c};return d}angular.module("achilles").service("DisabilityCertificate",a),a.$inject=["$http","urls"]}(),function(){"use strict";function a(a,b){function c(c){return a.get(b.documentList(c),{spinner:!0}).then(function(a){return a.data})}var d={list:c};return d}angular.module("achilles").service("Document",a),a.$inject=["$http","urls"]}(),function(){"use strict";function a(a,b,c){function d(){var d=b.defer();return f.length?d.resolve(f):g?h.push(d):(g=!0,a.get(c.treatmentEntryTypeList()).then(function(a){f=a.data;for(var b=0;b<f.length;b++)f[b].toString=function(){return this.id};g=!1,d.resolve(f),h.forEach(function(a){a.resolve(f)})})),d.promise}var e={all:d},f=[],g=!1,h=[];return e}angular.module("achilles").factory("EntryType",a),a.$inject=["$http","$q","urls"]}(),function(){"use strict";function a(a,b){function c(c,d,e){a.post(b.executeGDT(c,d,e)).then(function(){console.log("that worked")})["catch"](function(){console.log("that didn't")})}function d(c){a.get(b.gdtList()).then(function(a){c.gdtDevices=a.data})}var e={execute:c,load:d};return e}angular.module("achilles").factory("GDT",a),a.$inject=["$http","urls"]}(),function(){"use strict";function a(a,b){function c(c){return a.get(b.laboratoryList(c),{spinner:!0}).then(function(a){return a.data})}function d(c){a.get(b.laboratoryReport(c))}var e={list:c,open:d};return e}angular.module("achilles").service("LaboratoryReport",a),a.$inject=["$http","urls"]}(),function(){"use strict";function a(a,b,c){function d(d){a.get(b.lock(d,achillesConfig.process)).then(function(a){var b=a.data;b.lock?(d.locked=!0,d.lockedBy=b.lockedBy):(d.locked=!1,b.row.lastChange>d.lastChange?c.replace(d,b.row):0===b.row.id&&(d.id=0,d.deleted=!0))})}function e(c){var d={method:"POST",url:b.lock(c,achillesConfig.process,"put"),headers:{"Content-Type":"text/plain"}};a(d).then(function(a){204==a.status?c.hasOwnLock=!0:(c.lock=!0,c.lockedBy=a.data.lockedBy)})}var f={check:d,lock:e};return f}angular.module("achilles").factory("Locking",a),a.$inject=["$http","urls","TreatmentRow"]}(),function(){"use strict";function a(a){function b(){return e=a.defer(),f=!0,e.promise}function c(){return f}function d(a){e.resolve(a)}var e,f=!1,g={getName:b,isVisible:c,setName:d};return g}angular.module("achilles").factory("PresetWidget",a),a.$inject=["$q"]}(),function(){"use strict";function a(a,b,c){function d(){var d=b.defer();return g.length?d.resolve(g):h?i.push(d):(h=!0,a.get(c.presetList()).then(function(a){g=a.data;for(var b=0;b<g.length;b++)g[b].toString=function(){return this.id};h=!1,d.resolve(g),i.forEach(function(a){a.resolve(g)})})),d.promise}function e(b,d){a.post(c.createPreset(),{treatment:b,name:d})}var f={all:d,create:e},g=[],h=!1,i=[];return f}angular.module("achilles").factory("Preset",a),a.$inject=["$http","$q","urls"]}(),function(){"use strict";function a(a,b,c){function d(){var d=b.defer();return f.length?d.resolve(f):g?h.push(d):(g=!0,a.get(c.treatmentSubject()).then(function(a){f=a.data,g=!1,d.resolve(f),h.forEach(function(a){a.resolve(f)})})),d.promise}var e={all:d},f=[],g=!1,h=[];return e}angular.module("achilles").service("Subject",a),a.$inject=["$http","$q","urls"]}(),function(){"use strict";function a(){function a(a){h.push(a)}function b(){return f}function c(){return g}function d(){h.forEach(function(a){a(f)})}function e(a,b){f=a?b:void 0,g=a,d()}var f,g=!1,h=[],i={addObserverCallback:a,isVisible:c,getType:b,show:e};return i}angular.module("achilles").factory("TextBlockWidget",a)}(),function(){"use strict";function a(a,b,c){function d(){var d=b.defer();return f.length?d.resolve(f):g?h.push(d):(g=!0,a.get(c.textblock(achillesConfig.process)).then(function(a){f=a.data;for(var b=0;b<f.length;b++)f[b].toString=function(){return this.id};g=!1,d.resolve(f),h.forEach(function(a){a.resolve(f)})})),d.promise}var e={all:d},f=[],g=!1,h=[];return e}angular.module("achilles").factory("TextBlock",a),a.$inject=["$http","$q","urls"]}(),function(){"use strict";function a(a,b,c){function d(d,e,f){var g=e.rows;a.post(b.treatmentEntryRow("delete")+d.id).then(function(){for(var a=0;a<g.length;a++)if(g[a].id==d.id){g.splice(a,1);break}0===g.length&&c.removeEntry(e,f)})}var e={removeRow:d};return e}angular.module("achilles").factory("TreatmentEntry",a),a.$inject=["$http","urls","Treatment"]}(),function(){"use strict";function a(){function a(a,b){return("warn"==a.permission.modifyRange.mode||c-24*a.permission.modifyRange.pastDays*60*60*1e3<b.date&&c+24*a.permission.modifyRange.futureDays*60*60*1e3>b.date)&&(!b.isMandatorTreatment&&!a.isMandator||a.permission.editMandatorEntry&&(!a.isMandator||b.mandator==a.mandator.id))}function b(b,d){return a(b,d)?"warn"==b.permission.modifyRange.mode&&(c-24*b.permission.modifyRange.pastDays*60*60*1e3>d.date||c+24*b.permission.modifyRange.futureDays*60*60*1e3<d.date)?{displayed:!1,message:"Behandlungseintrag liegt ausserhalb des änderbaren Bereichs"}:!1:b.permission.editMandatorEntry?d.mandator!=b.mandator.id?{displayed:!1,message:"Nur der verantwortliche Mandant darf den Text ändern"}:void 0:{displayed:!1,message:"Sie verfügen nicht über die notwendigen Benutzerrechte um diese Aktion auszuführen"}}var c=Date.now(),d={checkEditPermission:a,shouldBeWarned:b};return d}angular.module("achilles").factory("TreatmentPermission",a)}(),function(){"use strict";function a(a,b,c){function d(){console.log("canceling"),b.cancel(g)}function e(a,b){a.columns=b.columns,a["new"]=b["new"],a.changed=!0,a.lastChange=b.lastChange}function f(d,e){g=b(function(){a.post(c.treatmentEntryRow("put"),d).then(function(a){for(var b=a.data,c=e.rows,d=0;d<c.length;d++)if(c[d].id==b.id){c[d]=b;break}b.locked=!1,b.hasOwnLock=!1})},150)}var g,h={cancelSave:d,replace:e,save:f};return h}angular.module("achilles").factory("TreatmentRow",a),a.$inject=["$http","$timeout","urls"]}(),function(){"use strict";function a(a,b,c,d){function e(b,e,f){return a.post(c.treatmentEntry(),{treatmentId:b,type:e}).then(function(a){for(var b=a.data,c=!1,g=0;g<f.length;g++)if(b.type.id==f[g].type.id){f[g]=b,c=!0;break}c||f.push(b),d.get().then(function(a){a.hiddenEntryTypes&&a.hiddenEntryTypes.indexOf(b.type.id)>-1&&d.changeVisibility(e,a)})})}function f(b,d,e){a.post(c.treatmentPreset(),{treatmentId:b,preset:d}).then(function(a){for(var c=a.data,d=0;d<e.length;d++)if(e[d].id==b){e[d]=c;break}})}function g(b,d,e,f){a.post(c.treatment(),{patient:achillesConfig.patient,process:achillesConfig.process,treatment:{id:b.id,isMandatorTreatment:d,isMainTreatment:e}}).then(function(a){f.push(a.data)})}function h(b,d){a.post(c.copyTreatment(),{process:achillesConfig.process,treatment:{id:b.id}}).then(function(a){d.push(a.data)})}function i(d,e){var f=b.open({templateUrl:"../js/templates/delete-modal.tpl.html",controller:"DeleteModalController",controllerAs:"mc",size:"sm"});f.result.then(function(){a.post(c.treatment("delete"),d).then(function(a){for(var b=0;b<e.length;b++)if(e[b].id==d.id){e.splice(b,1);break}})})}function j(b){b.closed=!b.closed,a.post(c.treatment("put"),b).then(function(a){b.closed=a.data.closed,console.log("treatment status changed")},function(a){b.closed=!b.closed})}function k(b,d){var e=b.subject;b.subject=d,a.post(c.treatment("put"),b).then(function(a){b.subject=a.data.subject},function(a){b.subject=e})}function l(b,d){var e=[];d.forEach(function(a){var b={id:a.id,rows:[]};a.entries.forEach(function(a){a.rows.forEach(function(a){b.rows.push(a.id)})}),e.push(b)}),a.post(c.treatmentReport(b),e)}function m(b){var d=b.invoiceCase;b.invoiceCase={id:0,name:""},a.post(c.treatment("put"),b).then(function(a){b.invoiceCase=a.data.invoiceCase},function(){b.invoiceCase=d})}function n(a,b){for(var c=0;c<b.length;c++)if(a.type.id==b[c].type.id){b.splice(c,1);break}}var o={addEntry:e,addPreset:f,addTreatment:g,copyTreatment:h,deleteTreatment:i,changeStatus:j,changeSubject:k,openReport:l,removeCase:m,removeEntry:n};return o}angular.module("achilles").factory("Treatment",a),a.$inject=["$http","$modal","urls","User"]}(),function(){"use strict";function a(){function a(){return A+B+":"+C+"/"}function b(b){return a()+D.caseList.replace(/:([a-z]\w*)/gi,b)+"/"}function c(b,c,d){return a()+D.catalogEntries.replace(/:term/,b).replace(/:row/,c.id).replace(/:column/,d.id)+(b>""?"/":"")}function d(b){return a()+D.catalogRow.replace(/:row/,b.id)+"/"}function e(b,c,d){var e="";return d&&(e=d+"/"),a()+e+D.lock.replace(/:row/,b.id).replace(/:process/,c)+"/"}function f(b,c,d){return a()+(d?D.executeGDTTest:D.executeGDT).replace(/:device/,b.id).replace(/:patient/,c).replace(/:test/,d?d.code:"")+"/"}function g(){return a()+D.presetList+"/"}function h(b){return a()+D.textblock.replace(/:process/,b)+"/"}function i(b){return a()+D.treatmentlist.replace(/:([a-z]\w*)/gi,b)+"/"}function j(){return a()+D.treatmententrytype+"/"}function k(){return a()+D.treatmententry+"/"}function l(b){var c="";return b&&(c=b+"/"),a()+c+D.treatmententryrow+"/"}function m(){return a()+D.treatmentpreset+"/"}function n(){return a()+D.treatmentsubject+"/"}function o(b){var c="";return b&&(c=b+"/"),a()+c+D.treatment+"/"}function p(){return a()+D.copyTreatment+"/"}function q(b){return a()+D.documentList.replace(/:([a-z]\w*)/gi,b)+"/"}function r(){return a()+D.gdtList+"/"}function s(b){return a()+D.laboratoryList.replace(/:([a-z]\w*)/gi,b)+"/"}function t(b){return a()+D.biometricList.replace(/:([a-z]\w*)/gi,b)+"/"}function u(b){return a()+D.disabilityList.replace(/:([a-z]\w*)/gi,b)+"/"}function v(b){return a()+D.removeCase.replace(/:treatment/gi,b.id).replace(/:case/gi,b.invoiceCase.id)+"/"}function w(b){return a()+D.biometricReport.replace(/:process/gi,b)+"/"}function x(b){return a()+D.laboratoryReport.replace(/:process/gi,b)+"/"}function y(b){return a()+D.treatmentReport.replace(/:process/gi,b)+"/"}function z(b,c){return a()+(c?c+"/":"")+D.user.replace(/:process/,b)+"/"}var A="http://",B=achillesConfig.baseUrl,C=achillesConfig.port,D={biometricList:"treatment/:treatment/biometriclist",biometricReport:"biometricreport/process/:process",caseList:"treatment/:treatment/caselist",catalogEntries:"catalog/treatmententryrow/:row/col/:column/term/:term",catalogRow:"catalog/treatmententryrow/:row",copyTreatment:"treatment/copy",disabilityList:"treatment/:treatment/disabilitylist",documentList:"treatment/:treatment/documentlist",laboratoryList:"treatment/:treatment/laboratorylist",laboratoryReport:"laboratoryreport/process/:process",removeCase:"treatment/:treatment/case/:case",treatmententry:"treatmententry",treatmententryrow:"treatmententryrow",treatmententrytype:"treatmententrytype",treatmentpreset:"put/treatmentpreset",treatmentlist:"patient/:patient/treatmentlist",treatmentReport:"treatmentreport/process/:process",treatmentsubject:"treatmentsubject",treatment:"treatment",gdtList:"gdt/list",executeGDT:"gdt/:device/patient/:patient",executeGDTTest:"gdt/:device/patient/:patient/code/:test",lock:"treatmententryrow/lock/:row/process/:process",user:"user/process/:process",textblock:"textblock/process/:process",presetList:"treatmentpreset"},E={baseUrl:a,biometricList:t,biometricReport:w,caseList:b,catalogEntries:c,catalogRow:d,copyTreatment:p,disabilityList:u,documentList:q,laboratoryList:s,laboratoryReport:x,removeCase:v,
treatmentEntryTypeList:j,treatmentEntry:k,treatmentEntryRow:l,treatmentPreset:m,treatmentList:i,treatmentSubject:n,treatment:o,treatmentReport:y,gdtList:r,executeGDT:f,lock:e,user:z,textblock:h,presetList:g};return E}angular.module("achilles").factory("urls",a)}(),function(){"use strict";function a(a,b,c,d){function e(){var c=b.defer();return h?c.resolve(h):j?k.push(c):(j=!0,a.get(d.user(l)).then(function(a){h=a.data,j=!1,c.resolve(h),k.forEach(function(a){a.resolve(h)})})),c.promise}function f(a,b){a.forEach(function(a){b.hiddenEntryTypes.indexOf(a.id)>-1&&(a.hidden=!0)})}function g(b,e,f){e.hiddenEntryTypes||(e.hiddenEntryTypes=[]);var g=e.hiddenEntryTypes,h=g.indexOf(b.id);void 0!==f?(f&&h>-1&&g.splice(h,1),f||-1!==h||g.push(b.id),b.hidden=!f):h>-1?(g.splice(h,1),b.hidden=!1):(g.push(b.id),b.hidden=!0),i&&0===i.$$state.status&&c.cancel(i),i=c(function(){a.post(d.user(l,"put"),e)},150)}var h,i,j=!1,k=[],l=achillesConfig.process,m={get:e,setVisibleEntryTypes:f,changeVisibility:g};return m}angular.module("achilles").factory("User",a),a.$inject=["$http","$q","$timeout","urls"]}(),function(){"use strict";function a(){function a(){return c}function b(a){c=a}var c=!1,d={getTitleSettingsWidgetVisibility:a,showTitleSettingsWidget:b};return d}angular.module("achilles").factory("WidgetVisibility",a)}();
//# sourceMappingURL=achilles.min.js.map