function callMe(){something++,angular.element("html").scope().$broadcast("updateTreatment",treatment)}function updateTreatment(a){angular.element("html").scope().$broadcast("updateTreatment",a)}!function(){"use strict";angular.module("achilles",["ngResource","ngSanitize","ui.bootstrap","rt.select2","textAngular"])}(),function(){"use strict";function a(a){a.defaults.headers.common["Achilles-Session"]=achillesConfig.process}angular.module("achilles").config(a),a.$inject=["$httpProvider"]}(),function(){"use strict";function a(a){a.interceptors.push("SpinnerHttpInterceptor")}function b(a,b){var c={response:function(a){return a.config.spinner&&(console.timeEnd("request"),$("#loading-overlay").hide()),a},responseError:function(b){return b.config.spinner&&$("#loading-overlay").hide(),a.reject(b)},request:function(a){return"GET"==a.method&&a.spinner&&(console.time("request"),$("#loading-overlay").show()),a}};return c}angular.module("achilles").config(a).factory("SpinnerHttpInterceptor",b),a.$inject=["$httpProvider"],b.$inject=["$q","$timeout"]}(),function(){"use strict";function a(a){a.decorator("taOptions",["taRegisterTool","$delegate",function(a,b){return a("colorRed",{iconclass:"fa fa-square red-text",action:function(){this.$editor().wrapSelection("forecolor","red")}}),a("colorBlue",{iconclass:"fa fa-square blue-text",action:function(){this.$editor().wrapSelection("forecolor","blue")}}),a("colorOrange",{iconclass:"fa fa-square orange-text",action:function(){this.$editor().wrapSelection("forecolor","orange")}}),a("colorGreen",{iconclass:"fa fa-square green-text",action:function(){this.$editor().wrapSelection("forecolor","green")}}),a("colorBlack",{iconclass:"fa fa-square",action:function(){this.$editor().wrapSelection("forecolor","black")}}),a("colorGrey",{iconclass:"fa fa-square grey-text",action:function(){this.$editor().wrapSelection("forecolor","lightgrey")}}),b.toolbar=[["bold","italics","underline","colorRed","colorOrange","colorGreen","colorBlue","colorBlack","colorGrey","ul","ol","redo","undo","clear"]],b}])}angular.module("achilles").config(a),a.$inject=["$provide"]}(),function(){"use strict";function a(a,b,c,d,e){function f(){d.load().then(function(a){i.treatments=a})}function g(){d.loadNext().then(function(a){i.treatments=i.treatments.concat(a)})}function h(){c.get().then(function(a){i.user=a})}var i=this;i.baseUrl=b.baseUrl(),i.loadEntries=f,i.loadNext=g,i.treatmentCount=d.count,i.patient=achillesConfig.patient,i.checkEditPermission=e.checkEditPermission,i.reverse=!1,i.search={},i.entries=[],i.marginOptions=[{"class":"large-margins",label:"Grosse Abstände"},{"class":"small-margins",label:"Kleine Abstände"}],i.fontSizes=[{"class":"large-fonts",label:"Gross"},{"class":"medium-fonts",label:"Mittel"},{"class":"small-fonts",label:"Klein"}],i.loadEntries(),h(),console.log("maincontroller line 34"),a.$on("updateTreatment",function(b,c){d.update(c,i.treatments),a.$apply()})}angular.module("achilles").controller("MainController",a),a.$inject=["$scope","urls","User","Treatment","TreatmentPermission"]}(),function(){"use strict";function a(a,b){a.ok=function(){b.close()},a.cancel=function(){b.dismiss("canceled")}}angular.module("achilles").controller("DeleteModalController",a),a.$inject=["$scope","$modalInstance"]}(),function(){"use strict";function a(){var a={controller:b,controllerAs:"dc",restrict:"E",scope:{search:"="},templateUrl:"../js/templates/advanced-search-widget.tpl.html"};return a}function b(a,b,c){function d(a){angular.copy({},a)}function e(a){a.preventDefault(),a.stopPropagation(),g.fromOpened=!0}function f(a){a.preventDefault(),a.stopPropagation(),g.toOpened=!0}var g=this;g.clearSearch=d,g.fromOpened=!1,g.isVisible=a.isVisible,g.openFromDatepicker=e,g.openToDatepicker=f,g.showWidget=a.show,g.toOpened=!1,b.all().then(function(a){g.subjects=a}),c.all().then(function(a){g.cases=a,console.log(a)})}angular.module("achilles").directive("advancedSearchWidget",a),b.$inject=["AdvancedSearchWidget","Subject","InvoiceCase"]}(),function(){"use strict";function a(){function a(a,b,c){var d={containment:"window"};c.draggableHandle&&(d.handle=c.draggableHandle),b.draggable(d)}var b={restrict:"A",link:a};return b}angular.module("achilles").directive("draggable",a)}(),function(){"use strict";function a(){function a(a,b,c){function d(a){function c(a){for(var b=0;b<a.length;b++)if(a.eq(b).hasClass("focused"))return b;return-1}function d(a){var c=b.find(".list-group"),d=c.scrollTop()+a.position().top-(c.height()-50);c.animate({scrollTop:d},0)}if((38==a.which||40==a.which||13==a.which)&&g){a.preventDefault();var h=b.find(e),i=b.find(e+f),j=c(h),k=h.length;38==a.which?(h.removeClass("focused"),i=j>0?h.eq(j-1).addClass("focused"):h.eq(k-1).addClass("focused"),d(i)):40==a.which?(h.removeClass("focused"),i=j>=0?h.eq((j+1)%k).addClass("focused"):h.eq(0).addClass("focused"),d(i)):13==a.which&&(i.click(),i.removeClass("focused"),b.blur())}}var e=c.focusable,f=".focused",g=!1;c.$observe("active",function(a){g="true"===a?!0:!1}),b.on("keydown",d)}var b={restrict:"A",link:a};return b}angular.module("achilles").directive("keyboardFocus",a)}(),function(){"use strict";function a(){function a(a,b,c){b.on("mousewheel",function(a,c){var d=b.height()+1,e=b.get(0).scrollHeight;(this.scrollTop>=e-d&&0>c||0===this.scrollTop&&c>0)&&a.preventDefault()})}var b={restrict:"A",link:a};return b}angular.module("achilles").directive("restrictedScroll",a)}(),function(){"use strict";function a(){var a={restrict:"E",controller:b,controllerAs:"dc",scope:{},templateUrl:"../js/templates/textblock-widget.tpl.html"};return a}function b(a,b,c,d,e){function f(b){b&&(i.textGroups=a("filter")(h,{treatmentEntryType:b.id}),i.selectedGroup={})}function g(a){var c="";if(!angular.isDefined(a))return void i.showWidget(!1);c=angular.isArray(a)?a.map(function(a){return a.text}).join(" "):a;var e=b.getCurrentlyFocusedColumn(),f=b.getCurrentlyFocusedRow(),g=b.getCurrentlyFocusedEntry();e&&g&&(e.content+=c,d.save(f,g)),i.showWidget(!1)}var h,i=this;i.insertSelection=g,i.isVisible=c.isVisible,i.showWidget=c.show,c.addObserverCallback(f),e.all().then(function(a){i.textGroups=h=a})}angular.module("achilles").directive("textBlockWidget",a),b.$inject=["$filter","CurrentFocus","TextBlockWidget","TreatmentRow","TextBlock"]}(),function(){"use strict";function a(){function a(a,b,c){c.$observe("show",function(){console.log("changed",c.show),a.showWidget=a.$eval(c.show)})}var c={restrict:"E",controller:b,controllerAs:"dc",link:a,scope:{showWidget:"="},templateUrl:"../js/templates/title-settings-widget.tpl.html"};return c}function b(a,b,c,d){function e(a,b){a.forEach(function(a){c.changeVisibility(a,h.user,b)})}function f(b,d,e){if(e.altKey){var f=a("filter")(h.entryTypes,function(a){return a!==b&&!a.hidden}).length>0;h.entryTypes.forEach(function(a){b!==a&&c.changeVisibility(a,h.user,!f)}),c.changeVisibility(b,h.user,!0)}else c.changeVisibility(b,h.user,d)}function g(){c.get().then(function(a){h.user=a,b.all().then(function(b){c.setVisibleEntryTypes(b,a),h.entryTypes=b})})}var h=this;h.changeTypeStatus=f,h.changeAll=e,h.isVisible=d.getTitleSettingsWidgetVisibility,h.showWidget=d.showTitleSettingsWidget,g()}angular.module("achilles").directive("titleSettingsWidget",a),a.$inject=["$timeout"],b.$inject=["$filter","EntryType","User","WidgetVisibility"]}(),function(){"use strict";function a(a){function b(b,c,d,e){c.on("click",function(){e.isOpen()&&a(function(){c.find("li a").eq(0).focus()},150)}),c.on("keydown","li a",function(a){if(40==a.which){a.preventDefault();var b=$(this).parent().nextAll(":visible:not(.divider)").first().find("a"),c=$(this).parent().siblings().first().find("a");b.length?b.focus():c.focus()}if(38==a.which){a.preventDefault();var d=$(this).parent().prevAll(":visible:not(.divider)").first().find("a"),e=$(this).parent().siblings().last().find("a");d.length?d.focus():e.focus()}})}var c={require:"dropdown",link:b};return c}angular.module("achilles").directive("toggleFocus",a),a.$inject=["$timeout"]}(),function(){"use strict";function a(a,c,d,e,f,g){function h(a,b){return"true"!==a?k.readonly:angular.isDefined(b.options)?k.dropdown:b.wysiwyg?k.wysiwyg:k.input}function i(b,i,k,l){function m(a,d){i.html(h(a,d)).show(),c(i.contents())(b)}function n(c){angular.element(this).hasClass("ng-dirty")&&!b.row.locked&&g.save(b.row,b.entry),a(function(){b.entry.focused=!1},150),a.cancel(j)}function o(c){if(b.row.locked&&w(c))c.preventDefault();else if(c.ctrlKey&&c.shiftKey&&8==c.which){var d=i.parents(".row").prev().find(".ta-bind:not(:disabled), .form-control:not(:disabled)"),h=i.parents(".row").next().find(".ta-bind:not(:disabled), .form-control:not(:disabled)"),j=i.parents("treatment-entry").prev().find(".ta-bind:not(:disabled), .form-control:not(:disabled)"),k=i.parents("treatment-entry").next().find(".ta-bind:not(:disabled), .form-control:not(:disabled)");a(function(){d.length?d.eq(0).focus():j.length?j.eq(0).focus():h.length?h.eq(0).focus():k.eq(0).focus()},150),x.removeRow(b.row,b.entry,b.treatment.entries)}else 27==c.keyCode?x.showCatalog=!1:c.ctrlKey&&13==c.which?(g.save(b.row,b.entry),f.addEntry(b.treatment.id,b.entry.type,b.treatment.entries)):!b.row.hasOwnLock&&w(c)&&e.lock(b.row)}function p(){a(function(){x.showCatalog=!1},150)}function q(a){w(a)&&13!=a.which&&x.lookupCatalogEntries(b.column.content.replace(/<[^>]*>/gm,""),b.row,b.column),d.setCurrentCursor()}function r(){x.showCatalog=!0,x.setCatalog(b.row),g.cancelSave(b.row),d.setCurrentFocus(b.column,b.row,b.entry),d.clearNewFocus(),b.warning&&!b.warning.displayed&&(toastr.warning(b.warning.message),b.warning.displayed=!0),j=a(function(){e.check(b.row)},450),a(function(){b.entry.focused=!0,b.column.wysiwyg?b.entry.showToolbar=!0:b.entry.showToolbar=!1},250)}function s(c){b.readonly()&&b.warning&&!b.warning.displayed&&(toastr.error(b.warning.message),b.warning.displayed=!0),a(function(){d.setCurrentCursor()},50)}function t(a,b){if(!a.length)return null;for(var c=a[0],d=c.innerHTML.replace(/<[^>]*>/,"").split(""),e=b;e<d.length;e++)if("*"===d[e])return e;return-1}function u(a){if(!a.length)return null;var b=a[0];return v(b)}function v(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(3==c.nodeType){if(c.nodeValue.indexOf("*")>=0)return c}else{var d=v(c);if(d)return d}}return null}function w(a){return!(9==a.which||a.which>=37&&a.which<=40||a.ctrlKey&&65==a.which||a.ctrlKey&&67==a.which)}var x=(l[0],l[1]);b.columnClass="col-xs-"+k.width,i.on("blur",".ta-bind, .form-control",n),i.on("change","select.form-control",n),i.on("keydown",".ta-bind, .form-control",o),i.on("focus",".ta-bind, .form-control",r),i.on("click",".ta-bind, .form-control",s),i.on("keyup",".ta-bind, .form-control",q),i.on("focusout",p),k.$observe("editable",function(a){m(a,b.column)}),m(k.editable,b.column),b.$watch(d.getNewlyFocusedRow,function(a){if(a&&b.row.id==a.id){var c=i.find(".ta-bind:not(.ta-readonly)");c.eq(0).focus();var e=u(c),f=d.getCurrentCursor(),g=t(c,f);if(g>=0){var h=document.createRange();h.setStart(e,g),h.setEnd(e,g+1);var j=window.getSelection();j.removeAllRanges(),j.addRange(h),d.setCurrentCursor()}}})}var j,k={wysiwyg:'<div ng-class="::columnClass" class="treatment-column" catalog-prompt><div class="form-group"><div ng-model="column.content" placeholder="{{::column.placeholder}}" ta-disabled="readonly()" text-angular ta-target-toolbars="toolbar-{{::treatment.id}}-{{::type.id}}"></div></div></div>',input:'<div ng-class="::columnClass" class="treatment-column" catalog-prompt><div class="form-group"><input ng-model="column.content" placeholder="{{::column.placeholder}}" class="form-control"></div></div></div>',dropdown:'<div ng-class="::columnClass" class="treatment-column"><div class="form-group"><select class="form-control" ng-model="column.content" ng-options="option as option for option in column.options"></select></div></div>',readonly:'<div ng-class="::columnClass" class="treatment-column"><div class="form-group"><div ng-bind-html="::readonlyContent" class="read-only-content form-control"></div></div></div>'},l={restrict:"E",scope:{width:"@",column:"=",readonly:"&",row:"=",uniqueId:"@",treatment:"=",warning:"=",type:"=",entry:"="},require:["^treatment","^treatmentEntry"],controller:b,link:i};return l}function b(a,b){a.readonlyContent=b.trustAsHtml(a.column.content)}angular.module("achilles").directive("treatmentColumn",a),a.$inject=["$timeout","$compile","CurrentFocus","Locking","Treatment","TreatmentRow"],b.$inject=["$scope","$sce"]}(),function(){"use strict";function a(){function a(a,b,c,d){}var c={scope:{entry:"=",editable:"@",treatment:"=",permissionToEdit:"&",warning:"="},restrict:"E",templateUrl:"../js/templates/treatment-entry.tpl.html",require:"^treatment",controller:b,controllerAs:"dc",link:a};return c}function b(a,b,c,d,e,f,g){function h(a,d,e){g.cancelSave(),c.choose(a,d).then(function(a){b(function(){console.log(a),f.replace(e,a)})})}function i(a){return p.user.hiddenEntryTypes&&p.user.hiddenEntryTypes.indexOf(a.id)>-1}function j(){d.get().then(function(a){p.user=a})}function k(a,d,e){b.cancel(o),o=b(function(){console.time("lookup"),c.lookup(a,d,e).then(function(a){console.timeEnd("lookup"),l(d,a)})},350)}function l(a,b){var c={};angular.isDefined(a)&&(c.id=a.id),angular.isDefined(b)&&(c.entries=b),p.catalog=c}function m(b){a.entry.focused=b}function n(){a.entryform.$setPristine()}var o,p=this;p.chooseCatalogEntry=h,p.isHidden=i,p.lookupCatalogEntries=k,p.makePristine=n,p.removeRow=f.removeRow,p.setCatalog=l,p.setEntryFocus=m,p.showTextBlockWidget=e.show,p.user={},p.showCatalog=!0,l(),j()}angular.module("achilles").directive("treatmentEntry",a),b.$inject=["$scope","$timeout","CatalogEntry","User","TextBlockWidget","TreatmentEntry","TreatmentRow"]}(),function(){"use strict";function a(a){function b(b,c){function d(){a(function(){var a=c.find(".ta-bind:not(.ta-readonly)").eq(0);a.focus()},150)}b.$watch("row.changed",function(a){a&&d()}),b.row["new"]===!0&&d()}var c={link:b};return c}angular.module("achilles").directive("treatmentRow",a),a.$inject=["$timeout"]}(),function(){"use strict";function a(){var a={restrict:"E",controller:b,controllerAs:"toolbar",templateUrl:"../js/templates/treatment-toolbar.tpl.html"};return a}function b(a,b,c,d,e,f,g,h,i){function j(b){var d=b.length?a("orderBy")(b,["-date","id"])[0]:{id:0};c.addTreatment(d,!0,!0,b)}var k=this;k.addTreatment=j,k.asteriskSearch=g.search,k.openBiometricReport=d.open,k.openLaboratoryReport=f.open,k.openTreatmentReport=c.openReport,k.executeGDT=e.execute,k.showAdvancedSearch=b.show,k.showTitleSettingsWidget=h.showTitleSettingsWidget,k.showPresetSettingsWidget=i.show,e.load(k)}angular.module("achilles").directive("treatmentToolbar",a),b.$inject=["$filter","AdvancedSearchWidget","Treatment","Biometric","GDT","LaboratoryReport","AsteriskSearch","WidgetVisibility","PresetSettingsWidget"]}(),function(){"use strict";function a(a){function b(b,c,d){function e(){a(function(){b.active=!0})}function f(){a(function(){b.active=!1},150)}function g(d){function e(){c.find("a.list-group-item:visible").first().addClass("focused")}function g(){c.find("a.list-group-item:visible").last().addClass("focused")}function h(a){var b=c.find(".list-group"),d=b.scrollTop()+a.position().top-(b.height()-50);b.animate({scrollTop:d},0)}var i=c.find("a.list-group-item.focused");if(8==d.which||d.which>40)a(function(){i.removeClass("focused"),angular.isDefined(b.search)&&b.search.term>""&&e()},50);else if(40==d.which)if(d.preventDefault(),i.length){var j=i.nextAll("a.list-group-item:visible").first();i.removeClass("focused"),j.addClass("focused"),h(j)}else e();else if(38==d.which)if(d.preventDefault(),i.length){var k=i.prevAll("a.list-group-item:visible").first();i.removeClass("focused"),k.addClass("focused"),h(k)}else g();else 13==d.which?i.click():27==d.keyCode&&f()}c.on("focusin",e),c.on("blur",f),c.find(".type-and-preset-search").on("blur",f),c.find(".type-and-preset-search").on("keyup",g)}var c={restrict:"A",link:b};return c}angular.module("achilles").directive("typeAndPreset",a),a.$inject=["$timeout"]}(),function(){"use strict";function a(){function a(a,b){var c=[];return angular.isDefined(b)?(a.forEach(function(a){var d=!0;b.medication!==!0||a.hasMedication||(d=!1),b.laboratory!==!0||a.hasLaboratory||(d=!1),b.service!==!0||a.hasService||(d=!1),b.disability!==!0||a.hasDisability||(d=!1),b.biometric!==!0||a.hasBiometric||(d=!1),b.document!==!0||a.hasDocument||(d=!1),d&&c.push(a)}),c):a}return a}angular.module("achilles").filter("attachments",a)}(),function(){"use strict";function a(){function a(a,b,c){var d=[];if(!angular.isDefined(a))return d;if(!angular.isDate(b)&&!/^\d{2}\.\d{2}\.(\d{2}|\d{4})$/.test(b))return a;if(!angular.isDate(b)){var e=b.split("."),f=e[0],g=e[1],h=e[2];b=new Date(h,g-1,f)}return a.forEach(function(a){("after"==c&&a.date>=b.getTime()||"before"==c&&a.date<=b.getTime())&&d.push(a)}),d}return a}angular.module("achilles").filter("compareDate",a)}(),function(){"use strict";function a(){function a(a,b){if(!angular.isDefined(b))return a;var c=[];return a.forEach(function(a){a.invoiceCase.id==b.id&&c.push(a)}),c}return a}angular.module("achilles").filter("invoiceCase",a)}();var something=0,treatment;treatment={id:20259,type:0,date:"1401795000000",subject:"",mandator:2,userToken:"ass",isMandatorTreatment:!0,isMainTreatment:!0,hasMedication:!1,hasLaboratory:!1,hasDocument:!1,hasDisability:!1,hasBiometric:!1,hasService:!1,closed:!1,billed:!1,invoiceCase:{name:"Deine Mutter",id:0},entries:[{treatmentId:20259,type:{id:149,name:"Arbeitsunfähigkeit:"},rows:[{"new":!1,id:94441,lastChange:"1433843222000",columns:[{content:"<p>koma asd</p>",type:63,id:97266,validation:"none",position:1,width:12,readonly:!1,wysiwyg:!1}]}]},{treatmentId:20259,type:{id:171,name:"Therapie:"},rows:[{"new":!1,id:94442,lastChange:"1433843222000",columns:[{content:"666",type:64,id:97267,validation:"none",position:1,width:2,readonly:!0,wysiwyg:!1},{content:"<b>Number of the Beast</b>",type:65,id:97268,validation:"none",position:2,width:10,readonly:!1,wysiwyg:!1}]}]},{treatmentId:20259,type:{id:168,name:"Status:"},rows:[{"new":!1,id:94443,lastChange:"1433843222000",columns:[{content:"<b>La la la, la la la</b>",type:63,id:97269,validation:"none",position:1,width:12,readonly:!1,wysiwyg:!1}]}]},{treatmentId:20259,type:{id:143,name:"Abklärungen:"},rows:[{"new":!1,id:95799,lastChange:"0",columns:[{content:"<p>D56 </p>",type:63,id:98955,validation:"none",position:1,width:12,readonly:!1,wysiwyg:!1}]}]}]},toastr.options={positionClass:"toast-top-full-width"},function(){"use strict";function a(a){function c(b,c,d,e){b.$watch(e.isVisible,function(d){d===!0&&(b.name="",a(function(){c.find('input[type="text"]').focus()},150))})}var d={restrict:"E",controller:b,controllerAs:"dc",link:c,scope:{},require:"createPresetWidget",templateUrl:"../js/preset/create-preset-widget.tpl.html"};return d}function b(a){var b=this;b.isVisible=a.isVisible,b.cancel=a.cancel,b.confirm=a.setName}angular.module("achilles").directive("createPresetWidget",a),a.$inject=["$timeout"],b.$inject=["CreatePresetWidget"]}(),function(){"use strict";function a(a){function b(){f.reject(),g=!1}function c(){return f=a.defer(),g=!0,f.promise}function d(){return g}function e(a){f.resolve(a),g=!1}var f,g=!1,h={cancel:b,getName:c,isVisible:d,setName:e};return h}angular.module("achilles").factory("CreatePresetWidget",a),a.$inject=["$q"]}(),function(){"use strict";function a(){var a={restrict:"E",controller:b,controllerAs:"dc",scope:{},templateUrl:"../js/preset/preset-settings-widget.tpl.html"};return a}function b(a,b,c,d){function e(a){var c=b.open({templateUrl:"../js/preset/delete-preset-modal.tpl.html",controller:"DeleteModalController",controllerAs:"mc",size:"sm"});c.result.then(function(){d.remove(a)})}var f=this;f.isVisible=c.isVisible,f.rename=d.rename,f.show=c.show,f.remove=e,d.all().then(function(a){f.presets=a}),a.$watch(d.hasUpdated,function(a){a===!0&&d.all().then(function(a){f.presets=a,d.setUpdated(!1)})})}angular.module("achilles").directive("presetSettingsWidget",a),b.$inject=["$scope","$modal","PresetSettingsWidget","Preset"]}(),function(){"use strict";function a(){function a(){return c}function b(a){c=a}var c=!1,d={isVisible:a,show:b};return d}angular.module("achilles").factory("PresetSettingsWidget",a)}(),function(){"use strict";function a(a,b,c){function d(){var d=b.defer();return l.length?d.resolve(l):m?n.push(d):(m=!0,a.get(c.presetList()).then(function(a){l=a.data;for(var b=0;b<l.length;b++)l[b].toString=function(){return this.id};m=!1,d.resolve(l),n.forEach(function(a){a.resolve(l)})})),d.promise}function e(b,d){a.post(c.createPreset(),{treatment:b,name:d}).then(function(a){l=a.data,j(!0)})}function f(){return o}function g(b){a.post(c.renamePreset(),b).then(function(a){l=a.data,j(!0)})}function h(b){a.post(c.deletePreset(),b).then(function(a){l=a.data,j(!0)})}function i(b,d){a.post(c.replacePreset(),{treatment:b,preset:d}).then(function(a){l=a.data,j(!0)})}function j(a){o=a}var k={all:d,create:e,hasUpdated:f,rename:g,remove:h,replace:i,setUpdated:j},l=[],m=!1,n=[],o=!1;return k}angular.module("achilles").factory("Preset",a),a.$inject=["$http","$q","urls"]}(),function(){"use strict";function a(){var a={restrict:"E",scope:{},controller:b,controllerAs:"dc",templateUrl:"../js/preset/replace-preset-widget.tpl.html"};return a}function b(a,b,c){var d=this;d.cancel=c.cancel,d.isVisible=c.isVisible,d.select=c.setPreset,b.all().then(function(a){d.presets=a}),a.$watch(b.hasUpdated,function(a){a===!0&&b.all().then(function(a){d.presets=a,b.setUpdated(!1)})})}angular.module("achilles").directive("replacePresetWidget",a),b.$inject=["$scope","Preset","ReplacePresetWidget"]}(),function(){"use strict";function a(a){function b(){return f}function c(){return e=a.defer(),f=!0,e.promise}function d(a){e.resolve(a),f=!1}var e,f=!1,g={isVisible:b,selectPreset:c,setPreset:d};return g}angular.module("achilles").factory("ReplacePresetWidget",a),a.$inject=["$q"]}(),function(){"use strict";function a(){function a(){return c}function b(a){c=a}var c=!1,d={isVisible:a,show:b};return d}angular.module("achilles").factory("AdvancedSearchWidget",a)}(),function(){"use strict";function a(a,b){function c(c){var d,e,f,g,h=[];if(d=b.getCurrentlyFocusedRow(),c.forEach(function(b){if("true"===b.editable||b.editable===!0){var c=a("orderBy")(b.entries,"type.name");c.forEach(function(a){a.rows.forEach(function(a){h.push(a)})})}}),d){for(var i=b.getCurrentlyFocusedColumn(),j=i.content.replace(/<[^>]>/,"").split(""),k=0,l=0;l<j.length;l++)"*"==j[l]&&(k=l);k>b.getCurrentCursor()?f=h.slice(h.indexOf(d)):(f=h.slice(h.indexOf(d)+1),b.setCurrentCursor(0))}else f=h;g=a("filter")(f,{$:"*"}),0===g.length&&(g=a("filter")(h,{$:"*"})),e=g.shift(),e&&(console.log(e),b.setNewFocus(e))}var d={search:c};return d}angular.module("achilles").factory("AsteriskSearch",a),a.$inject=["$filter","CurrentFocus"]}(),function(){"use strict";function a(a,b){function c(c){return a.get(b.biometricList(c),{spinner:!0}).then(function(a){return a.data})}function d(){a.get(b.biometricReport())}var e={list:c,open:d};return e}angular.module("achilles").service("Biometric",a),a.$inject=["$http","urls"]}(),function(){"use strict";function a(a,b,c){function d(b,d){return a.post(c.catalogRow(d),b).then(function(a){return a.data})}function e(d,e,f){return a.get(c.catalogEntries(d,e,f)).then(function(a){var c=a.data;return angular.forEach(c,function(a){angular.forEach(a.cols,function(a){a.trustedContent=b.trustAsHtml(a.content)})}),c})}var f={choose:d,lookup:e};return f}angular.module("achilles").factory("CatalogEntry",a),a.$inject=["$http","$sce","urls"]}(),function(){"use strict";function a(){function a(){return m}function b(){return k}function c(){return l}function d(){return j}function e(){return n}function f(a){if(angular.isDefined(a))m=a;else{var b=window.getSelection();m=b.focusOffset}}function g(a,b,c){k=a,j=b,l=c}function h(){n=null}function i(a){n=a}var j,k,l,m,n,o={clearNewFocus:h,getCurrentCursor:a,getCurrentlyFocusedColumn:b,getCurrentlyFocusedEntry:c,setCurrentCursor:f,setCurrentFocus:g,getCurrentlyFocusedRow:d,setNewFocus:i,getNewlyFocusedRow:e};return o}angular.module("achilles").factory("CurrentFocus",a)}(),function(){"use strict";function a(a,b){function c(c){return a.get(b.disabilityList(c),{spinner:!0}).then(function(a){return a.data})}var d={list:c};return d}angular.module("achilles").service("DisabilityCertificate",a),a.$inject=["$http","urls"]}(),function(){"use strict";function a(a,b){function c(c){return a.get(b.documentList(c),{spinner:!0}).then(function(a){return a.data})}var d={list:c};return d}angular.module("achilles").service("Document",a),a.$inject=["$http","urls"]}(),function(){"use strict";function a(a,b,c){function d(){var d=b.defer();return f.length?d.resolve(f):g?h.push(d):(g=!0,a.get(c.treatmentEntryTypeList()).then(function(a){f=a.data;for(var b=0;b<f.length;b++)f[b].toString=function(){return this.id};g=!1,d.resolve(f),h.forEach(function(a){a.resolve(f)})})),d.promise}var e={all:d},f=[],g=!1,h=[];return e}angular.module("achilles").factory("EntryType",a),a.$inject=["$http","$q","urls"]}(),function(){"use strict";function a(a,b){function c(c,d,e){a.post(b.executeGDT(c,d,e)).then(function(){console.log("that worked")})["catch"](function(){console.log("that didn't")})}function d(c){a.get(b.gdtList()).then(function(a){c.gdtDevices=a.data})}var e={execute:c,load:d};return e}angular.module("achilles").factory("GDT",a),a.$inject=["$http","urls"]}(),function(){"use strict";function a(a,b){function c(){return a.get(b.cases(achillesConfig.patient)).then(function(a){return a.data})}var d={all:c};return d}angular.module("achilles").factory("InvoiceCase",a),a.$inject=["$http","urls"]}(),function(){"use strict";function a(a,b){function c(c){return a.get(b.laboratoryList(c),{spinner:!0}).then(function(a){return a.data})}function d(){a.get(b.laboratoryReport())}var e={list:c,open:d};return e}angular.module("achilles").service("LaboratoryReport",a),a.$inject=["$http","urls"]}(),function(){"use strict";function a(a,b,c){function d(d){a.get(b.lock(d)).then(function(a){var b=a.data;b.lock?(d.locked=!0,d.lockedBy=b.lockedBy):(d.locked=!1,b.row.lastChange>d.lastChange?c.replace(d,b.row):0===b.row.id&&(d.id=0,d.deleted=!0))})}function e(c){var d={method:"POST",url:b.lock(c,"put"),headers:{"Content-Type":"text/plain"}};a(d).then(function(a){204==a.status?c.hasOwnLock=!0:(c.lock=!0,c.lockedBy=a.data.lockedBy)})}var f={check:d,lock:e};return f}angular.module("achilles").factory("Locking",a),a.$inject=["$http","urls","TreatmentRow"]}(),function(){"use strict";function a(a,b,c){function d(){var d=b.defer();return f.length?d.resolve(f):g?h.push(d):(g=!0,a.get(c.treatmentSubject()).then(function(a){f=a.data,g=!1,d.resolve(f),h.forEach(function(a){a.resolve(f)})})),d.promise}var e={all:d},f=[],g=!1,h=[];return e}angular.module("achilles").service("Subject",a),a.$inject=["$http","$q","urls"]}(),function(){"use strict";function a(){function a(a){h.push(a)}function b(){return f}function c(){return g}function d(){h.forEach(function(a){a(f)})}function e(a,b){f=a?b:void 0,g=a,d()}var f,g=!1,h=[],i={addObserverCallback:a,isVisible:c,getType:b,show:e};return i}angular.module("achilles").factory("TextBlockWidget",a)}(),function(){"use strict";function a(a,b,c){function d(){var d=b.defer();return f.length?d.resolve(f):g?h.push(d):(g=!0,a.get(c.textblock()).then(function(a){f=a.data;for(var b=0;b<f.length;b++)f[b].toString=function(){return this.id};g=!1,d.resolve(f),h.forEach(function(a){a.resolve(f)})})),d.promise}var e={all:d},f=[],g=!1,h=[];return e}angular.module("achilles").factory("TextBlock",a),a.$inject=["$http","$q","urls"]}(),function(){"use strict";function a(a,b,c){function d(d,e,f){var g=e.rows;a.post(b.treatmentEntryRow("delete")+d.id).then(function(){for(var a=0;a<g.length;a++)if(g[a].id==d.id){g.splice(a,1);break}0===g.length&&c.removeEntry(e,f)})}function e(a,b){angular.copy(b,a)}var f={removeRow:d,replace:e};return f}angular.module("achilles").factory("TreatmentEntry",a),a.$inject=["$http","urls","Treatment"]}(),function(){"use strict";function a(){function a(a,b){return("warn"==a.permission.modifyRange.mode||c-24*a.permission.modifyRange.pastDays*60*60*1e3<b.date&&c+24*a.permission.modifyRange.futureDays*60*60*1e3>b.date)&&(!b.isMandatorTreatment&&!a.isMandator||a.permission.editMandatorEntry&&(!a.isMandator||b.mandator==a.mandator.id))}function b(b,d){return a(b,d)?"warn"==b.permission.modifyRange.mode&&(c-24*b.permission.modifyRange.pastDays*60*60*1e3>d.date||c+24*b.permission.modifyRange.futureDays*60*60*1e3<d.date)?{displayed:!1,message:"Behandlungseintrag liegt ausserhalb des änderbaren Bereichs"}:!1:b.permission.editMandatorEntry?d.mandator!=b.mandator.id?{displayed:!1,message:"Nur der verantwortliche Mandant darf den Text ändern"}:void 0:{displayed:!1,message:"Sie verfügen nicht über die notwendigen Benutzerrechte um diese Aktion auszuführen"}}var c=Date.now(),d={checkEditPermission:a,shouldBeWarned:b};return d}angular.module("achilles").factory("TreatmentPermission",a)}(),function(){"use strict";function a(a,b,c){function d(a){angular.isDefined(a)&&angular.isDefined(h)&&a.id!==h.id||(b.cancel(g),h=void 0)}function e(a,b){a.columns=b.columns,a["new"]=b["new"],a.changed=!0,a.lastChange=b.lastChange}function f(d,e){h=d,g=b(function(){a.post(c.treatmentEntryRow("put"),d).then(function(a){for(var b=a.data,c=e.rows,d=0;d<c.length;d++)if(c[d].id==b.id){c[d]=b;break}b.locked=!1,b.hasOwnLock=!1}),h=void 0},150)}var g,h,i={cancelSave:d,replace:e,save:f};return i}angular.module("achilles").factory("TreatmentRow",a),a.$inject=["$http","$timeout","urls"]}(),function(){"use strict";function a(){function a(){return F+G+":"+H+"/"}function b(b){return a()+I.caseList.replace(/:([a-z]\w*)/gi,b)+"/"}function c(b){return a()+I.cases.replace(/:patient/,b)+"/"}function d(b,c,d){return a()+I.catalogEntries.replace(/:term/,b).replace(/:row/,c.id).replace(/:column/,d.id)+(b>""?"/":"")}function e(b){return a()+I.catalogRow.replace(/:row/,b.id)+"/"}function f(){return a()+I.createPreset+"/"}function g(){return a()+I.deletePreset+"/"}function h(b,c){var d="";return c&&(d=c+"/"),a()+d+I.lock.replace(/:row/,b.id)+"/"}function i(b,c,d){return a()+(d?I.executeGDTTest:I.executeGDT).replace(/:device/,b.id).replace(/:patient/,c).replace(/:test/,d?d.code:"")+"/"}function j(){return a()+I.presetList+"/"}function k(){return a()+I.renamePreset+"/"}function l(){return a()+I.replacePreset+"/"}function m(){return a()+I.textblock+"/"}function n(b,c){var d="";return angular.isDefined(c)&&(d="/from/"+c),a()+I.treatmentlist.replace(/:([a-z]\w*)/gi,b)+d+"/"}function o(){return a()+I.treatmententrytype+"/"}function p(){return a()+I.treatmententry+"/"}function q(b){var c="";return b&&(c=b+"/"),a()+c+I.treatmententryrow+"/"}function r(){return a()+I.treatmentpreset+"/"}function s(){return a()+I.treatmentsubject+"/"}function t(b){var c="";return b&&(c=b+"/"),a()+c+I.treatment+"/"}function u(){return a()+I.copyTreatment+"/"}function v(b){return a()+I.documentList.replace(/:([a-z]\w*)/gi,b)+"/"}function w(){return a()+I.gdtList+"/"}function x(b){return a()+I.laboratoryList.replace(/:([a-z]\w*)/gi,b)+"/"}function y(b){return a()+I.biometricList.replace(/:([a-z]\w*)/gi,b)+"/"}function z(b){return a()+I.disabilityList.replace(/:([a-z]\w*)/gi,b)+"/"}function A(b){return a()+I.removeCase.replace(/:treatment/gi,b.id).replace(/:case/gi,b.invoiceCase.id)+"/"}function B(){return a()+I.biometricReport+"/"}function C(){return a()+I.laboratoryReport+"/"}function D(){return a()+I.treatmentReport+"/"}function E(b){return a()+(b?b+"/":"")+I.user+"/"}var F="http://",G=achillesConfig.baseUrl,H=achillesConfig.port,I={biometricList:"treatment/:treatment/biometriclist",biometricReport:"biometricreport",caseList:"treatment/:treatment/caselist",cases:"patient/:patient/invoiceCase",catalogEntries:"catalog/treatmententryrow/:row/col/:column/term/:term",catalogRow:"catalog/treatmententryrow/:row",copyTreatment:"treatment/copy",createPreset:"preset/create",
deletePreset:"delete/preset",disabilityList:"treatment/:treatment/disabilitylist",documentList:"treatment/:treatment/documentlist",laboratoryList:"treatment/:treatment/laboratorylist",laboratoryReport:"laboratoryreport",removeCase:"treatment/:treatment/case/:case",renamePreset:"preset/rename",replacePreset:"preset/replace",treatment:"treatment",treatmententry:"treatmententry",treatmententryrow:"treatmententryrow",treatmententrytype:"treatmententrytype",treatmentpreset:"put/treatmentpreset",treatmentlist:"patient/:patient/treatmentlist",treatmentReport:"treatmentreport",treatmentsubject:"treatmentsubject",gdtList:"gdt/list",executeGDT:"gdt/:device/patient/:patient",executeGDTTest:"gdt/:device/patient/:patient/code/:test",lock:"treatmententryrow/lock/:row",user:"user",textblock:"textblock",presetList:"treatmentpreset"},J={baseUrl:a,biometricList:y,biometricReport:B,caseList:b,cases:c,catalogEntries:d,catalogRow:e,copyTreatment:u,createPreset:f,deletePreset:g,disabilityList:z,documentList:v,laboratoryList:x,laboratoryReport:C,removeCase:A,renamePreset:k,replacePreset:l,treatmentEntryTypeList:o,treatmentEntry:p,treatmentEntryRow:q,treatmentPreset:r,treatmentList:n,treatmentSubject:s,treatment:t,treatmentReport:D,gdtList:w,executeGDT:i,lock:h,user:E,textblock:m,presetList:j};return J}angular.module("achilles").factory("urls",a)}(),function(){"use strict";function a(a,b,c,d){function e(){var c=b.defer();return h?c.resolve(h):j?k.push(c):(j=!0,a.get(d.user()).then(function(a){h=a.data,j=!1,c.resolve(h),k.forEach(function(a){a.resolve(h)})})),c.promise}function f(a,b){a.forEach(function(a){b.hiddenEntryTypes.indexOf(a.id)>-1&&(a.hidden=!0)})}function g(b,e,f){e.hiddenEntryTypes||(e.hiddenEntryTypes=[]);var g=e.hiddenEntryTypes,h=g.indexOf(b.id);void 0!==f?(f&&h>-1&&g.splice(h,1),f||-1!==h||g.push(b.id),b.hidden=!f):h>-1?(g.splice(h,1),b.hidden=!1):(g.push(b.id),b.hidden=!0),i&&0===i.$$state.status&&c.cancel(i),i=c(function(){a.post(d.user("put"),e)},150)}var h,i,j=!1,k=[],l={get:e,setVisibleEntryTypes:f,changeVisibility:g};return l}angular.module("achilles").factory("User",a),a.$inject=["$http","$q","$timeout","urls"]}(),function(){"use strict";function a(){function a(){return c}function b(a){c=a}var c=!1,d={getTitleSettingsWidgetVisibility:a,showTitleSettingsWidget:b};return d}angular.module("achilles").factory("WidgetVisibility",a)}(),function(){"use strict";function a(a){function c(b,c,d,e){var f;b.treatment.editable=b.editable,c.on("keydown",function(a){120==a.which&&e.permissionToEdit&&c.find(".type-and-preset-search").focus()}),c.on("focusin",function(){a(function(){b.treatment.focused=!0,b.editable=!0,b.treatment.editable=!0}),a.cancel(f)}),c.on("focusout",function(){f=a(function(){b.treatment.focused=!1},300)})}var d={scope:{treatment:"=",treatments:"=treatmentlist",editable:"@",user:"="},restrict:"E",controller:b,controllerAs:"dc",templateUrl:"../js/treatment/treatment.tpl.html",link:c};return d}function b(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(b,c,d){f.addEntry(b,c,d).then(function(){a.active=!1})}function p(a){m.getName().then(function(b){l.create(a,b)})}function q(a){n.selectPreset().then(function(b){l.replace(a,b)})}function r(a){a&&!v.documents&&h.list(w).then(function(a){v.documents=a},function(a){console.error(a.statusText),v.documents=[]})}function s(a){a&&!v.laboratoryReports&&i.list(w).then(function(a){v.laboratoryReports=a},function(){})}function t(a){a&&!v.biometrics&&j.list(w).then(function(a){v.biometrics=a},function(){})}function u(a){a&&!v.disabilityCertificates&&k.list(w).then(function(a){v.disabilityCertificates=a},function(){})}var v=this,w=a.treatment.id;v.newEntry={type:null},v.addEntry=o,v.addPreset=f.addPreset,v.createPreset=p,v.loadDocuments=r,v.loadLaboratoryReports=s,v.loadBiometrics=t,v.loadDisability=u,v.replacePreset=q,v.baseUrl=b.baseUrl(),v.addTreatment=f.addTreatment,v.copyTreatment=f.copyTreatment,v.deleteTreatment=f.deleteTreatment,v.changeStatus=f.changeStatus,v.changeSubject=f.changeSubject,v.removeCase=f.removeCase,v.warning={},v.permissionToEdit=!1,v.removeEntry=f.removeEntry,c.all().then(function(a){v.types=a}),g.all().then(function(a){v.subjects=a}),l.all().then(function(a){v.presets=a}),a.$watch(l.hasUpdated,function(a){a===!0&&l.all().then(function(a){v.presets=a,l.setUpdated(!1)})}),e.get().then(function(b){v.warning=d.shouldBeWarned(b,a.treatment),v.permissionToEdit=d.checkEditPermission(b,a.treatment)})}angular.module("achilles").directive("treatment",a),a.$inject=["$timeout"],b.$inject=["$scope","urls","EntryType","TreatmentPermission","User","Treatment","Subject","Document","LaboratoryReport","Biometric","DisabilityCertificate","Preset","CreatePresetWidget","ReplacePresetWidget"]}(),function(){"use strict";function a(a,b,c,d,e){function f(b,c,f){return a.post(d.treatmentEntry(),{treatmentId:b,type:c}).then(function(a){for(var b=a.data,d=!1,g=0;g<f.length;g++)if(b.type.id==f[g].type.id){f[g]=b,d=!0;break}d||f.push(b),e.get().then(function(a){a.hiddenEntryTypes&&a.hiddenEntryTypes.indexOf(b.type.id)>-1&&e.changeVisibility(c,a)})})}function g(b,c,e){a.post(d.treatmentPreset(),{treatmentId:b,preset:c}).then(function(a){for(var c=a.data,d=0;d<e.length;d++)if(e[d].id==b){e[d]=c;break}})}function h(b,c,e,f){a.post(d.treatment(),{patient:achillesConfig.patient,treatment:{id:b.id,isMandatorTreatment:c,isMainTreatment:e}}).then(function(a){f.push(a.data)})}function i(b,c){a.post(d.copyTreatment(),{treatment:{id:b.id}}).then(function(a){c.push(a.data)})}function j(){return u}function k(b,e){var f=c.open({templateUrl:"../js/templates/delete-modal.tpl.html",controller:"DeleteModalController",controllerAs:"mc",size:"sm"});f.result.then(function(){a.post(d.treatment("delete"),b).then(function(a){for(var c=0;c<e.length;c++)if(e[c].id==b.id){e.splice(c,1);break}})})}function l(b){b.closed=!b.closed,a.post(d.treatment("put"),b).then(function(a){b.closed=a.data.closed,console.log("treatment status changed")},function(a){b.closed=!b.closed})}function m(b,c){var e=b.subject;b.subject=c,a.post(d.treatment("put"),b).then(function(a){b.subject=a.data.subject},function(a){b.subject=e})}function n(){return console.time("load"),a.get(d.treatmentList(achillesConfig.patient),{spinner:!0}).then(function(a){return t=a.data.urlnext,u=a.data.count,console.timeEnd("load"),a.data.treatments})}function o(){if(console.time("loadNext"),!angular.isDefined(t)){var c=b.defer();return c.reject(),c.promise}return a.get(d.baseUrl()+t,{spinner:!0}).then(function(a){return t=a.data.urlnext,u=a.data.count,console.timeEnd("loadNext"),a.data.treatments})}function p(b){var c=[];b.forEach(function(a){var b={id:a.id,rows:[]};a.entries.forEach(function(a){a.rows.forEach(function(a){b.rows.push(a.id)})}),c.push(b)}),a.post(d.treatmentReport(),c)}function q(b){var c=b.invoiceCase;b.invoiceCase={id:0,name:""},a.post(d.treatment("put"),b).then(function(a){b.invoiceCase=a.data.invoiceCase},function(){b.invoiceCase=c})}function r(a,b){for(var c=0;c<b.length;c++)if(a.type.id==b[c].type.id){b.splice(c,1);break}}function s(a,b){for(var c=0;c<b.length;c++)if(a.id==b[c].id)return void(b[c]=a);b.push(a)}var t,u=0,v={addEntry:f,addPreset:g,addTreatment:h,copyTreatment:i,changeStatus:l,changeSubject:m,count:j,deleteTreatment:k,load:n,loadNext:o,openReport:p,removeCase:q,removeEntry:r,update:s};return v}angular.module("achilles").factory("Treatment",a),a.$inject=["$http","$q","$modal","urls","User"]}();
//# sourceMappingURL=achilles.min.js.map